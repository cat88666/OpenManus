# OpenManus 开发规范

## 添加新工具
1. 在 `app/tool/` 目录下创建新文件
2. 继承 `BaseTool` 类
3. 实现 `execute()` 方法（必须是异步）
4. 定义 `name` 和 `description` 属性
5. 使用 Pydantic 模型定义参数
6. 返回 `ToolResult` 对象
7. 参考现有工具实现（如 `str_replace_editor.py`, `python_execute.py`）

## 添加新智能体
1. 在 `app/agent/` 目录下创建新文件
2. 继承 `ToolCallAgent` 或 `BaseAgent`
3. 实现必要的抽象方法
4. 配置 `available_tools` 工具集合
5. 参考 `manus.py` 的实现

## 配置文件
- 配置文件位于 `config/config.toml`
- 使用 `app.config.config` 访问配置
- 配置项使用 TOML 格式
- 支持多模型配置（`[llm]`, `[llm.vision]`）

## 工作空间
- 生成的文件保存在 `workspace/` 目录
- 日志文件保存在 `logs/` 目录
- 不要将生成的文件提交到版本控制

## 测试要求
- 新功能必须通过本地测试
- 使用 `python main.py --prompt "测试您的新功能"` 进行测试
- 确保不破坏现有功能


## Git 提交规范
- 使用有意义的提交信息
- 格式：`feat: 描述` 或 `fix: 描述`
- 提交前确保代码通过测试

## 环境要求
- 必须使用 conda 环境 `open_manus`
- Python 版本 3.11
- 所有依赖在 `requirements.txt` 中定义
- 浏览器驱动通过 `playwright install` 安装



## MCP 集成
- MCP 服务器连接在智能体初始化时建立
- 使用 `MCPClients` 管理连接
- 工具自动添加到 `available_tools`

## 资源清理
- 智能体必须实现 `cleanup()` 方法
- 清理浏览器上下文、MCP 连接等资源
- 在 `finally` 块中调用清理方法

## 工具执行流程
1. 智能体分析任务需求
2. 自动选择合适工具
3. 执行工具（最多 20 步）
4. 处理工具返回结果
5. 继续下一步或完成任务

## 提示词管理
- 提示词模板位于 `app/prompt/` 目录
- 使用格式化字符串插入变量
- 系统提示词包含工作空间路径等信息
