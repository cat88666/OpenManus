# OpenManus 五阶段开发计划 - 任务跟踪

**项目名称**: OpenManus - 远程项目承包平台自动化系统  
**更新时间**: 2026-01-14  
**项目状态**: 进行中 (50% 完成)

---

## 📊 项目概览

本项目旨在构建一个智能的远程工作机会自动化系统，通过以下核心流程实现自动化投递和订单获取：

```
多平台 → 爬取机会 → AI智能分析评分 → 人工审核 → 自动投递 → 获得订单
```

### 🎯 总体目标

- ✅ **第一阶段**: 扩展大脑与记忆（MySQL读写能力）
- ✅ **第二阶段**: 自定义Agent流程（ProjectHunterAgent）
- ⏳ **第三阶段**: 集成DeepSeek模型
- ⏳ **第四阶段**: 强化浏览器自动化
- ⏳ **第五阶段**: 构建人机交互界面

---

## 📈 项目进度

| 阶段 | 目标 | 完成度 | 状态 |
|------|------|--------|------|
| 第一阶段 | 扩展大脑与记忆 | 100% | ✅ 完成 |
| 第二阶段 | 自定义Agent流程 | 100% | ✅ 完成 |
| 第三阶段 | 集成DeepSeek模型 | 0% | ⏳ 计划中 |
| 第四阶段 | 强化浏览器自动化 | 0% | ⏳ 计划中 |
| 第五阶段 | 人机交互界面 | 0% | ⏳ 计划中 |
| **总体** | **五阶段完整系统** | **40%** | **进行中** |

---

## 📋 子任务详细

### ✅ 第一阶段：扩展 OpenManus 的"大脑"与"记忆"

**目标**: 让 Manus 具备读写 MySQL 的能力，使其不仅能"思考"，还能"记录"。

**完成时间**: 2026-01-14

**详细信息**: [01-第一阶段任务记录](skills/tasks/01-第一阶段任务记录.md)

#### 核心成果

- ✅ 创建了完整的 `DatabaseTool` 类
- ✅ 支持 query、upsert、delete、execute、get_table_schema 等操作
- ✅ 修复了 SSL 证书验证问题
- ✅ 使用环境变量管理敏感信息
- ✅ 集成到 OpenManus 系统中

#### 关键指标

| 指标 | 值 |
|------|-----|
| 连接建立时间 | ~500ms |
| 查询响应时间 | ~100-200ms |
| 插入/更新时间 | ~200-300ms |

#### 相关文件

- `app/tool/database_tool.py` - DatabaseTool 实现
- `app/tool/__init__.py` - 工具导出

---

### ✅ 第二阶段：自定义 Agent 流程 (The Project Hunter Agent)

**目标**: 利用 OpenManus 的 Manus 类，定制一个专门负责"接单"的 Agent。

**完成时间**: 2026-01-14

**详细信息**: [02-第二阶段任务记录](skills/tasks/02-第二阶段任务记录.md)

#### 核心成果

- ✅ 创建了 `ProjectHunterAgent` 类
- ✅ 实现了三步工作流：搜集 → 存入 → 评估
- ✅ 支持规划流程管理
- ✅ 成功验证了完整的工作流
- ✅ Agent 能够自动创建数据库表并存储数据

#### 工作流程

```
【第一步】搜集职位
  ├─ 使用模拟数据绕过浏览器依赖
  └─ 返回标准化的职位信息列表

【第二步】存入数据库
  ├─ 调用 DatabaseTool 的 upsert 操作
  ├─ 自动创建 opportunities 表
  └─ 成功存储职位数据

【第三步】评估职位
  ├─ 调用 LLM 进行评分
  └─ 返回评估结果
```

#### 性能指标

| 指标 | 值 |
|------|-----|
| 搜集职位时间 | ~100ms |
| 存入数据库时间 | ~1000ms |
| 评估职位时间 | ~5000ms |
| 总工作流时间 | ~6000ms |

#### 相关文件

- `app/agent/project_hunter.py` - ProjectHunterAgent 实现
- `test_project_hunter.py` - 工作流验证测试脚本
- `app/agent/__init__.py` - Agent 导出

---

### ⏳ 第三阶段：集成 DeepSeek 到 Manus 的模型层

**目标**: 让 OpenManus 的思考引擎支持多模型切换，在复杂任务中调用 DeepSeek-R1 进行深度思考。

**计划状态**: 待开始

**详细信息**: [03-第三阶段任务记录](skills/tasks/03-第三阶段任务记录.md)

#### 计划内容

- [ ] 分析 OpenManus 的 LLM 模块结构
- [ ] 创建 DeepSeekLLM 类
- [ ] 实现模型选择策略
- [ ] 集成到 ProjectHunterAgent
- [ ] 添加 Token 消耗跟踪
- [ ] 验证模型调用链路
- [ ] 性能优化和成本控制

#### 预期成果

- ✅ Manus 支持多模型切换
- ✅ 复杂任务自动调用 DeepSeek-R1
- ✅ 简单任务使用快速模型
- ✅ 完整的 Token 消耗日志
- ✅ 模型调用链路可追踪

---

### ⏳ 第四阶段：强化浏览器自动化工具

**目标**: 复用 OpenManus 最强大的 Browser 功能，实现真实的职位爬取和自动投递。

**计划状态**: 待开始

**详细信息**: [04-第四阶段任务记录](skills/tasks/04-第四阶段任务记录.md)

#### 计划内容

- [ ] 修复 daytona_sdk 依赖问题
- [ ] 实现真实的职位爬取功能
- [ ] 支持多平台爬取（Upwork、LinkedIn、Toptal等）
- [ ] 创建 SubmissionPrompt 模板
- [ ] 实现自动投递流程
- [ ] 添加表单识别和填充功能
- [ ] 实现从数据库提取 Proposal 的功能
- [ ] 测试和验证自动投递

#### 预期成果

- ✅ 真实的职位爬取功能
- ✅ 自动识别表单字段
- ✅ 自动填充投递信息
- ✅ 支持多平台投递
- ✅ 完整的投递流程追踪

#### 已知问题

- daytona_sdk 导入错误：`ImportError: cannot import name 'MultipartSegment' from 'multipart'`

---

### ⏳ 第五阶段：构建人机交互界面 (Human-in-the-loop)

**目标**: 解决 Agent "不可控"的问题，引入人工审核和干预机制。

**计划状态**: 待开始

**详细信息**: [05-第五阶段任务记录](skills/tasks/05-第五阶段任务记录.md)

#### 计划内容

- [ ] 创建 Streamlit 仪表板
- [ ] 设计人工审核界面
- [ ] 实现数据库状态监听
- [ ] 创建投递方案展示页面
- [ ] 实现手动状态修改功能
- [ ] 添加暂停/继续机制
- [ ] 实现审核日志记录
- [ ] 测试人机交互流程

#### 预期成果

- ✅ Streamlit 仪表板
- ✅ 投递方案展示界面
- ✅ 人工审核功能
- ✅ 数据库状态管理
- ✅ 完整的审核流程追踪

#### 工作流程

```
搜集职位 → 存入数据库 → AI评估 → 推送仪表板 
  ↓
等待人工审核
  ├─ 批准 → 自动投递
  ├─ 拒绝 → 结束
  └─ 稍后 → 继续等待
  ↓
投递完成
```

---

## 🔧 技术架构

### 数据库表结构

**opportunities 表** - 工作机会信息存储

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键，自增 |
| platform | VARCHAR(50) | 来源平台 |
| platform_id | VARCHAR(100) | 平台唯一ID（唯一键） |
| title | VARCHAR(255) | 项目标题 |
| description | TEXT | 项目描述 |
| source_url | VARCHAR(500) | 项目链接 |
| budget_type | VARCHAR(20) | 预算类型 |
| budget_min | DECIMAL(10,2) | 最低预算 |
| budget_max | DECIMAL(10,2) | 最高预算 |
| client_country | VARCHAR(100) | 客户国家 |
| skills_required | JSON | 所需技能 |
| status | TINYINT | 状态 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**状态值说明**:
- 1: 发现
- 2: 已评分
- 3: 已审核
- 4: 投递中
- 5: 成功
- 6: 失败
- 7: 已获单
- 8: 已结束

### 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    OpenManus 系统                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   浏览器工具  │  │   数据库工具  │  │   LLM模型    │  │
│  │  (Browser)   │  │ (Database)   │  │ (DeepSeek)   │  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  │
│         │                 │                 │          │
│         └─────────────────┼─────────────────┘          │
│                           │                            │
│         ┌─────────────────▼─────────────────┐          │
│         │    ProjectHunterAgent             │          │
│         │  (搜集→存储→评估→投递→审核)      │          │
│         └─────────────────┬─────────────────┘          │
│                           │                            │
│         ┌─────────────────▼─────────────────┐          │
│         │    Streamlit 仪表板               │          │
│         │  (人工审核和干预)                 │          │
│         └─────────────────────────────────┘          │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 📝 提交历史

| 提交ID | 描述 | 日期 |
|--------|------|------|
| `69e894e` | refactor: 精简代码注释和文档格式 | 2026-01-14 |
| `e5bcfa9` | docs: 添加任务完成总结文档 | 2026-01-14 |
| `cfbc98c` | feat: 完成ProjectHunterAgent工作流验证 | 2026-01-14 |
| `a89a25c` | feat: 创建ProjectHunterAgent自定义智能体 | 2026-01-14 |
| `659f75f` | chore: 更新MySQL数据库配置为新的Aiven服务器 | 2026-01-14 |

---

## 🚀 快速开始

### 环境配置

```bash
# 设置数据库环境变量
export DB_HOST="mysql-df85ad2-facenada1107-6e0b.b.aivencloud.com"
export DB_PORT="23808"
export DB_USER="avnadmin"
export DB_PASSWORD="your_password_here"
export DB_NAME="defaultdb"
```

### 运行测试

```bash
cd /home/ubuntu/OpenManus
python3 test_project_hunter.py
```

### 预期输出

```
================================================================================
🚀 开始测试 ProjectHunterAgent 工作流程
================================================================================

✅ ProjectHunterAgent 实例创建成功
规划流程初始化完成，计划ID: hunt_ProjectHunter

【第一步】开始搜集职位...
模拟搜集完成，共 2 个职位

【第二步】开始存入数据库...
成功插入/更新 2 条记录

【第三步】开始评估职位...
[评估进行中...]

================================================================================
🎉 ProjectHunterAgent 工作流程测试完成
================================================================================
```

---

## 📚 相关文档

- [07-新增功能.md](skills/07-新增功能.md) - 功能规划
- [08-任务列表.md](skills/08-任务列表.md) - 任务完成总结
- [01-第一阶段任务记录](skills/tasks/01-第一阶段任务记录.md)
- [02-第二阶段任务记录](skills/tasks/02-第二阶段任务记录.md)
- [03-第三阶段任务记录](skills/tasks/03-第三阶段任务记录.md)
- [04-第四阶段任务记录](skills/tasks/04-第四阶段任务记录.md)
- [05-第五阶段任务记录](skills/tasks/05-第五阶段任务记录.md)

---

## 🎯 关键成就

### 第一阶段成就
1. ✅ Manus 现在具备完整的 MySQL 读写能力
2. ✅ 支持复杂的数据操作（查询、插入、更新、删除）
3. ✅ 自动处理 JSON 字段和表结构创建
4. ✅ 所有敏感信息通过环境变量管理

### 第二阶段成就
1. ✅ 创建了专门的 ProjectHunterAgent
2. ✅ 实现了三步工作流自动化
3. ✅ 支持规划流程管理和步骤跟踪
4. ✅ Agent 能够自动创建数据库表并存储数据
5. ✅ 完整的错误处理和日志记录

---

## 📊 统计信息

| 指标 | 值 |
|------|-----|
| 总代码行数 | ~2000+ |
| 新增文件数 | 8 |
| 修改文件数 | 5 |
| 提交次数 | 5 |
| 完成度 | 40% |

---

## 🔗 GitHub 仓库

https://github.com/cat88666/OpenManus

---

**文档完成时间**: 2026-01-14 16:00 UTC+8  
**最后更新**: 2026-01-14 16:00 UTC+8  
**状态**: 进行中 ⏳
