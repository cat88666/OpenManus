# 第五阶段：构建人机交互界面 (Human-in-the-loop) - 任务记录

**阶段目标**: 解决 Agent "不可控"的问题，引入人工审核和干预机制。  
**计划时间**: 待开始  
**状态**: ⏳ 计划中

---

## 📋 任务概览

| 任务 | 描述 | 状态 |
|------|------|------|
| Step 5 | 接入外部干预机制 | ⏳ 计划中 |

---

## Step 5: 接入外部干预机制

### 📌 任务描述

逻辑：在 OpenManus 的决策循环中加入一个 wait_for_user 环节。

指令：在 `ProjectHunterAgent` 的规划逻辑中加入一个暂停点。当 AI 准备好投递方案后，它必须将方案输出到 Streamlit 界面，并监听数据库状态，直到我手动将状态改为 'Approved'，它才继续执行下一步。

### 📋 子任务清单

- [ ] 创建 Streamlit 仪表板
- [ ] 设计人工审核界面
- [ ] 实现数据库状态监听
- [ ] 创建投递方案展示页面
- [ ] 实现手动状态修改功能
- [ ] 添加暂停/继续机制
- [ ] 实现审核日志记录
- [ ] 测试人机交互流程

### 🎯 预期成果

1. ✅ Streamlit 仪表板
2. ✅ 投递方案展示界面
3. ✅ 人工审核功能
4. ✅ 数据库状态管理
5. ✅ 完整的审核流程追踪

### 📊 界面设计

#### 主仪表板

```
┌─────────────────────────────────────────────────────────┐
│  OpenManus - 项目猎手系统                                │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📊 统计信息                                             │
│  ├─ 待审核: 5 个                                        │
│  ├─ 已批准: 12 个                                       │
│  ├─ 已投递: 8 个                                        │
│  └─ 成功: 3 个                                          │
│                                                          │
│  📋 待审核项目列表                                       │
│  ├─ [1] Build Python AI Agent (Upwork)                 │
│  │   预算: $50-80/hr | 技能: Python, AI, LLM           │
│  │   [👁️ 查看] [✅ 批准] [❌ 拒绝]                      │
│  │                                                      │
│  └─ [2] Remote Backend Engineer (LinkedIn)             │
│      预算: $10k-15k | 技能: Go, Python, Microservices  │
│      [👁️ 查看] [✅ 批准] [❌ 拒绝]                      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 审核详情页面

```
┌─────────────────────────────────────────────────────────┐
│  项目详情 - Build Python AI Agent                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📌 基本信息                                             │
│  ├─ 平台: Upwork                                        │
│  ├─ 标题: Build a Python AI Agent for Automation       │
│  ├─ 预算: $50-80/hr                                     │
│  ├─ 客户国家: USA                                       │
│  └─ 链接: https://www.upwork.com/jobs/...              │
│                                                          │
│  📝 项目描述                                             │
│  We need an experienced developer to build an AI agent  │
│  using Python. The agent should be able to perform      │
│  automated tasks, interact with APIs, and manage data.  │
│  Experience with LLMs and frameworks like LangChain is  │
│  a plus.                                                │
│                                                          │
│  🤖 AI 评估结果                                          │
│  ├─ 匹配度: 95%                                         │
│  ├─ 难度: 中等                                          │
│  ├─ 成功概率: 85%                                       │
│  └─ 建议: 强烈推荐投递                                  │
│                                                          │
│  💼 投递方案                                             │
│  [显示完整方案]                                          │
│                                                          │
│  ✅ 批准投递  ❌ 拒绝  ⏸️ 稍后决定                       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 🔄 工作流程

```
1. ProjectHunterAgent 搜集职位
   ↓
2. 存入数据库 (status=1: 发现)
   ↓
3. AI 评估职位 (status=2: 已评分)
   ↓
4. 推送到 Streamlit 仪表板
   ↓
5. 等待人工审核
   ├─ 批准 → status=3: 已审核 → 自动投递
   ├─ 拒绝 → status=6: 失败 → 结束
   └─ 稍后 → status=2: 已评分 → 继续等待
   ↓
6. 自动投递 (status=4: 投递中)
   ↓
7. 投递完成 (status=5: 成功 或 status=6: 失败)
```

### 📚 相关文件

- `app/ui/streamlit_app.py` - 待创建
- `app/agent/project_hunter.py` - ProjectHunterAgent
- `app/database/models.py` - 数据模型

### 🎯 关键功能

1. **实时监听**
   - 监听数据库状态变化
   - 自动刷新仪表板
   - 实时通知

2. **人工审核**
   - 展示 AI 评估结果
   - 支持批准/拒绝/稍后
   - 记录审核意见

3. **自动投递**
   - 批准后自动投递
   - 投递进度追踪
   - 投递结果记录

4. **数据管理**
   - 查看历史记录
   - 导出数据
   - 统计分析

---

**计划开始时间**: 待定  
**状态**: ⏳ 计划中
