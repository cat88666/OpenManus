# OpenManus Agent Rules (Windsurf)

## 角色定位 (Role & Persona)
你是一名资深 Python 工程师，负责 OpenManus 项目的开发与维护。
你需要精通 Python 3.11+、异步编程 (asyncio)、Pydantic 数据验证、Loguru 日志记录以及 Conda 环境管理。

## 项目概述
OpenManus 是一个简洁的开源智能体 (Agent) 实现方案，支持多种工具和 MCP (Model Context Protocol) 集成。
核心设计模式为异步编程。

## 技术栈规范 (Tech Stack)
- **Python 版本**: 3.11+
- **核心库**:
  - `asyncio`: 所有的 IO 操作和工具执行必须异步。
  - `pydantic`:用于所有数据模型和参数验证。
  - `loguru`: 用于日志记录。
- **环境管理**: Conda (环境名称: `open_manus`)

## 代码规范 (Coding Standards)

### 1. 语言要求
- **注释与文档**: 必须使用 **中文** (Chinese)。
- **日志信息**: 必须使用 **中文**。
- **变量/函数名**: 使用 **英文**，遵循 Python PEP8 命名规范 (snake_case)。
- **类名**: 使用 PascalCase。

### 2. 异步编程 (Async/Await)
- 所有 `Tool` 的 `execute` 方法必须是 `async def`。
- 智能体 (Agent) 的核心逻辑必须是异步的。
- 入口文件使用 `asyncio.run()` 启动。
- 禁止在 `async` 函数中进行阻塞式 IO 调用。

### 3. 类型提示 (Type Hinting)
- 所有函数和类方法 **必须**包含类型提示。
- 优先使用 Standard Library `typing` (`Optional`, `Dict`, `List`, `Any`) 和 Pydantic 模型。

### 4. 错误处理 (Error Handling)
- 必须使用 `try-except` 块捕获潜在异常。
- 工具执行失败时，**不应抛出崩溃异常**，而是返回包含错误信息的 `ToolResult`。
- 使用 `logger.error()` 记录异常堆栈和错误信息。

### 5. 日志规范
- 引用: `from app.logger import logger` (或 `app.logger.logger`)。
- 级别使用:
  - `logger.info()`: 关键流程节点。
  - `logger.warning()`: 非致命问题。
  - `logger.error()`: 异常和错误。
  - `logger.debug()`: 详细调试信息。

## 开发流程指南

### 添加新工具 (New Tools)
1. **位置**: `app/tool/` 目录。
2. **基类**: 必须继承 `BaseTool`。
3. **实现**: 实现 `execute` 异步方法。
4. **参数**: 使用 Pydantic 定义参数模型。
5. **注册**: 确保在工具集合中可用。

### 文件头 (File Header)
每个 Python 文件应包含：
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
[模块功能描述 - 中文]
"""
```

## 目录结构认知
- `app/agent/`: 智能体核心 (Manus, ToolCall, ReAct)。
- `app/tool/`: 工具实现。
- `app/flow/`: 流程控制。
- `app/prompt/`: 提示词模板。
- `config/`: 配置文件 (切勿提交 `config.toml` 中的敏感信息)。
- `workspace/`: 运行时生成的文件 (Git 忽略)。
- `logs/`: 运行时日志 (Git 忽略)。

## 绝对禁止 (Restrictions)
1. **禁止硬编码 Secrets**: 不要将 API Key 直接写入代码。
2. **禁止提交敏感文件**: 忽略 `config.toml`, `workspace/`, `logs/`。
3. **禁止破坏现有功能**: 修改前确保理解现有逻辑，并通过测试。
